<div class="studio-root" [class.sidebar-open]="isSidebarOpen" [class.sidebar-hidden]="isSidebarHiddenDesktop">
  <header class="top-nav" role="banner">
    <div class="top-nav-inner">
      <div class="top-nav-left">
        <button
          class="icon-btn sidebar-toggle-btn"
          type="button"
          (click)="toggleSidebar()"
          [attr.aria-label]="isSidebarHiddenDesktop ? 'Show sidebar' : 'Hide sidebar'"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>

        <div class="brand" aria-label="Sentinent Decision Studio">
          <div class="brand-text">
            <p class="brand-kicker">Sentinent</p>
            <p class="brand-title">Decision Studio</p>
          </div>
        </div>
      </div>

      <div class="top-nav-center desktop-only">
        <div class="global-search app-search">
          <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="M21 21l-4.35-4.35"></path>
          </svg>
          <input
            #globalSearchInput
            type="text"
            [(ngModel)]="searchQuery"
            (input)="onSearch(searchQuery)"
            placeholder="Search decisions, signals, owners..."
            aria-label="Global search"
          />
          <kbd class="kbd">Ctrl+K</kbd>

          <div class="search-dropdown" *ngIf="searchResults.length > 0">
            <button
              type="button"
              class="search-result"
              *ngFor="let result of searchResults; trackBy: trackById"
              (click)="useSearchResult(result)"
            >
              <span class="result-type">{{ result.type }}</span>
              <span class="result-title">{{ result.title }}</span>
              <span class="result-subtitle">{{ result.subtitle }}</span>
            </button>
          </div>
        </div>
      </div>

      <div class="top-nav-right">
        <button type="button" class="primary-btn desktop-only" (click)="openNewDecisionModal()">
          New Decision
        </button>

        <button class="icon-btn nav-theme-btn" type="button" (click)="toggleTheme()" aria-label="Toggle color theme">
          <svg *ngIf="!isDarkMode" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 12.79A9 9 0 1111.21 3c0 .02 0 .05-.01.07A7 7 0 0021 12.79z" />
          </svg>
          <svg *ngIf="isDarkMode" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 4V2m0 20v-2m8-8h2M2 12h2m12.95 6.95l1.41 1.41M3.64 3.64l1.41 1.41m11.9 0l1.41-1.41M3.64 20.36l1.41-1.41M12 7a5 5 0 100 10 5 5 0 000-10z" />
          </svg>
        </button>

        <button type="button" class="icon-btn mobile-only" (click)="openNewDecisionModal()" aria-label="Create new decision">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5v14M5 12h14" />
          </svg>
        </button>

        <clerk-user-button></clerk-user-button>
      </div>
    </div>
  </header>

  <div class="shell">
    <div class="sidebar-overlay" *ngIf="isSidebarOpen" (click)="toggleSidebar()" aria-hidden="true"></div>

    <aside class="sidebar" [class.sidebar-open]="isSidebarOpen" aria-label="Primary navigation">
      <section class="sidebar-section">
        <p class="sidebar-label">Workspace</p>
        <div class="workspace-wrap">
          <button
            class="workspace-btn"
            type="button"
            [class.open]="isWorkspaceMenuOpen"
            [attr.aria-expanded]="isWorkspaceMenuOpen"
            aria-haspopup="menu"
            aria-label="Select workspace"
            (click)="toggleWorkspaceMenu()"
          >
            <span>{{ activeWorkspaceName }}</span>
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 9l6 6 6-6" /></svg>
          </button>

          <div class="workspace-menu" *ngIf="isWorkspaceMenuOpen" role="menu" aria-label="Workspace list">
            <button
              type="button"
              class="workspace-option"
              *ngFor="let workspace of workspaceOptions; trackBy: trackById"
              [class.active]="workspace.id === selectedWorkspaceId"
              (click)="selectWorkspace(workspace.id)"
            >
              <span>{{ workspace.name }}</span>
            </button>
          </div>
        </div>
      </section>

      <section class="sidebar-section">
        <p class="sidebar-label">Platform</p>
        <nav class="sidebar-nav" aria-label="Platform navigation">
          <button
            type="button"
            class="nav-item"
            *ngFor="let option of viewOptions"
            [class.active]="currentView === option.key"
            (click)="setView(option.key)"
          >
            <span class="nav-main">{{ option.label }}</span>
            <span class="nav-meta" *ngIf="option.shortcut">{{ option.shortcut }}</span>
            <span class="unread-pill" *ngIf="option.unread">{{ inboxUnreadCount }}</span>
          </button>
        </nav>
      </section>

      <section class="sidebar-section">
        <p class="sidebar-label">Operations</p>
        <nav class="sidebar-nav" aria-label="Operations navigation">
          <button
            type="button"
            class="nav-item"
            *ngFor="let option of operationsOptions"
            [class.active]="currentView === option.key"
            (click)="setView(option.key)"
          >
            <span class="nav-main">{{ option.label }}</span>
            <span class="disconnected-dot" *ngIf="option.disconnected && hasDisconnectedIntegrations" aria-hidden="true"></span>
          </button>
        </nav>
      </section>

      <section class="alert-card" aria-label="Risk alert">
        <p class="alert-title">Churn Risk</p>
        <p class="alert-text">3 enterprise accounts flagged</p>
        <button type="button" class="alert-link" (click)="setView('inbox')">Review now -></button>
      </section>

      <footer class="sidebar-footer" aria-live="polite">
        <span class="live-dot"></span>
        <span>System compiling signals</span>
      </footer>
    </aside>

    <main class="main-content" role="main">
      <section class="chat-view" *ngIf="currentView === 'chat'">
        <aside class="chat-list-panel" aria-label="Chat threads">
          <header class="panel-header">
            <div>
              <h2 class="panel-title">Chats</h2>
              <p class="panel-subtitle">Recent conversations in your workspace.</p>
            </div>
            <button type="button" class="chip-btn ghost" (click)="startNewChatThread()">New</button>
          </header>

          <div class="chat-thread-tools">
            <input
              class="input"
              type="text"
              [(ngModel)]="chatThreadSearch"
              placeholder="Search chats..."
              aria-label="Search chats"
            />
          </div>

          <div class="chat-thread-list" *ngIf="filteredChatThreads.length > 0; else noChatThreads">
            <button
              type="button"
              class="chat-thread-item"
              *ngFor="let thread of filteredChatThreads; trackBy: trackById"
              [class.active]="thread.id === activeChatThreadId"
              (click)="openChatThread(thread.id)"
            >
              <span class="chat-thread-title">{{ thread.title }}</span>
              <span class="chat-thread-preview">{{ thread.preview || 'No messages yet' }}</span>
              <span class="chat-thread-time">{{ thread.updatedAt }}</span>
            </button>
          </div>

          <ng-template #noChatThreads>
            <div class="chat-thread-empty">No chats found.</div>
          </ng-template>
        </aside>

        <section class="chat-panel claude-chat-panel" aria-label="Decision chat">
          <header class="panel-header chat-header">
            <div>
              <h1 class="panel-title">{{ activeChatThread.title }}</h1>
              <p class="panel-subtitle">Ask Sentient. Get a decision-ready answer.</p>
            </div>
            <button type="button" class="chip-btn ghost">Share</button>
          </header>

          <div class="chat-empty-state" *ngIf="chatIsEmpty">
            <p class="chat-empty-pill">Free plan - Upgrade</p>
            <h2>Good {{ chatGreetingPeriod }}, Jatin</h2>
            <p>Type / for commands or ask Sentient to map your next product move.</p>
          </div>

          <div class="messages chat-live" role="log" aria-live="polite" *ngIf="!chatIsEmpty">
            <article class="message" *ngFor="let message of chatMessages; trackBy: trackById" [class.message-user]="message.role === 'user'">
              <div class="avatar">{{ message.role === 'user' ? 'YO' : 'SNT' }}</div>
              <div class="bubble">
                <div class="message-meta">
                  <span class="message-name">{{ message.name }}</span>
                  <span>{{ message.timestamp }}</span>
                </div>
                <p class="message-content">{{ message.content }}</p>
                <div class="citations" *ngIf="message.citations?.length">
                  <span class="citation" *ngFor="let cite of message.citations">{{ cite }}</span>
                </div>
              </div>
            </article>

            <article class="message" *ngIf="chatIsLoading" aria-live="polite">
              <div class="avatar">SNT</div>
              <div class="bubble typing-bubble">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
              </div>
            </article>
          </div>

          <div class="suggestions-row" *ngIf="!chatIsEmpty">
            <button type="button" class="chip-btn" *ngFor="let suggestion of chatSuggestions" (click)="useSuggestion(suggestion)">
              {{ suggestion }}
            </button>
            <button type="button" class="chip-btn ghost" *ngIf="chatMessages.length > 1" (click)="clearChat()">Clear Chat</button>
            <button type="button" class="chip-btn ghost" *ngIf="chatMessages.length > 1" (click)="exportChat()">Export</button>
          </div>

          <footer class="composer" [class.composer-empty]="chatIsEmpty">
            <div class="composer-input-wrap">
              <textarea
                class="composer-input"
                [(ngModel)]="chatInput"
                (keydown)="onChatKeydown($event)"
                (input)="autoResizeTextarea($event)"
                [disabled]="chatIsLoading"
                rows="1"
                [placeholder]="chatIsEmpty ? 'Type / for commands' : 'Reply...'"
                aria-label="Decision chat input"
              ></textarea>
              <button type="button" class="send-btn" (click)="sendChat()" [disabled]="chatIsLoading" aria-label="Send message">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 2L11 13" /><path d="M22 2l-7 20-4-9-9-4 20-7z" /></svg>
              </button>
            </div>
            <div class="composer-footer">
              <span>AI responses may contain mistakes. Verify before execution.</span>
              <span>Enter to send</span>
            </div>
          </footer>
        </section>
      </section>
      <section class="inbox-view" *ngIf="currentView === 'inbox'">
        <div class="kpi-grid">
          <article class="kpi-card" *ngFor="let card of kpiCards">
            <p class="kpi-label">{{ card.label }}</p>
            <p class="kpi-value">{{ getKpiValue(card) }}</p>
            <p class="kpi-trend" [class.trend-up]="card.direction === 'up'" [class.trend-down]="card.direction === 'down'">
              <span>{{ kpiDirectionIcon(card.direction) }}</span>
              {{ card.trend }}
            </p>
          </article>
        </div>

        <div class="inbox-grid">
          <section class="surface-card">
            <header class="card-head">
              <h2>Decision Queue</h2>
              <button type="button" class="chip-btn ghost">Priority: All</button>
            </header>
            <div class="queue-list">
              <article
                class="queue-item"
                *ngFor="let decision of decisionQueue; trackBy: trackById"
                [class.active]="decision.id === activeDecision.id"
                (click)="selectDecision(decision.id)"
              >
                <div class="queue-main">
                  <div class="queue-top">
                    <span class="risk-dot" [ngClass]="riskClass(decision.risk)" aria-hidden="true"></span>
                    <h3>{{ decision.title }}</h3>
                  </div>
                  <p class="queue-meta">{{ decision.owner }} - {{ decision.confidence }}% - {{ decision.impact }}</p>
                  <p class="queue-description">{{ decision.description }}</p>
                </div>
                <span class="status-pill" [ngClass]="statusClass(decision.status)">{{ statusLabel(decision.status) }}</span>
              </article>
            </div>
          </section>

          <section class="surface-card detail-card">
            <header class="card-head">
              <h2>Decision Detail</h2>
              <span class="chip-btn ghost">{{ activeDecision.confidence }}% confidence</span>
            </header>
            <div class="detail-block">
              <p class="detail-label">Problem</p>
              <p>{{ activeDecision.problem }}</p>
            </div>
            <div class="detail-block">
              <p class="detail-label">Evidence</p>
              <p>{{ activeDecision.evidence }}</p>
            </div>
            <div class="detail-block">
              <p class="detail-label">Tradeoff</p>
              <p>{{ activeDecision.tradeoff }}</p>
            </div>
            <div class="detail-options">
              <p class="detail-label">Options</p>
              <article class="option-card" *ngFor="let option of activeDecision.options">
                <span class="option-radio" aria-hidden="true"></span>
                <div>
                  <h4>{{ option.title }}</h4>
                  <p>{{ option.detail }}</p>
                </div>
              </article>
            </div>
            <footer class="detail-footer">{{ activeDecision.owner }} - {{ activeDecision.impact }}</footer>
          </section>
        </div>

        <div class="inbox-grid bottom-grid">
          <section class="surface-card">
            <header class="card-head">
              <h2>Signal Stream</h2>
              <span class="chip-btn ghost">Auto-tagging on</span>
            </header>
            <div class="signal-list">
              <article class="signal-item" *ngFor="let signal of signalStream; trackBy: trackById">
                <div class="signal-icon">{{ signal.source.charAt(0) }}</div>
                <div class="signal-body">
                  <p class="signal-title">{{ signal.source }} - {{ signal.timestamp }}</p>
                  <p class="signal-text">{{ signal.summary }}</p>
                </div>
              </article>
            </div>
            <footer class="signal-footer">98% normalized - View all signals</footer>
          </section>

          <section class="velocity-card">
            <p class="velocity-value">24h</p>
            <p class="velocity-label">Avg time to decision</p>
            <div class="velocity-bars" aria-hidden="true">
              <span></span><span></span><span></span><span></span>
            </div>
          </section>
        </div>

        <section class="surface-card timeline-card">
          <header class="card-head">
            <h2>Timeline</h2>
          </header>
          <div class="timeline-list">
            <article class="timeline-item" *ngFor="let event of timelineEvents; trackBy: trackById">
              <span class="timeline-dot" [class.timeline-success]="event.tone === 'success'" [class.timeline-warning]="event.tone === 'warning'"></span>
              <div>
                <h3>{{ event.title }}</h3>
                <p>{{ event.detail }}</p>
                <span>{{ event.time }}</span>
              </div>
            </article>
          </div>
        </section>
      </section>

      <section class="agent-view" *ngIf="currentView === 'agent'">
        <header class="view-head">
          <div class="agent-title-row">
            <h1>Feature Research Operator</h1>
            <span class="chip-btn ghost demo-mode-badge" *ngIf="featureResearchDemoMode">DEMO MODE</span>
          </div>
          <p>Run live web research with TinyFish and generate a strict JSON Research Brief.</p>
        </header>

        <section class="surface-card agent-query-card">
          <div class="agent-form-grid">
            <div class="field">
              <label for="research-feature" class="field-label">Feature *</label>
              <input
                id="research-feature"
                class="input"
                type="text"
                [(ngModel)]="featureResearchForm.feature"
                placeholder="Dark Mode"
              />
            </div>

            <div class="field">
              <label for="research-category" class="field-label">Category *</label>
              <input
                id="research-category"
                class="input"
                type="text"
                [(ngModel)]="featureResearchForm.category"
                placeholder="PM tools"
              />
            </div>

            <div class="field">
              <label for="research-persona" class="field-label">Persona (optional)</label>
              <input
                id="research-persona"
                class="input"
                type="text"
                [(ngModel)]="featureResearchForm.persona"
                placeholder="Product manager at startup"
              />
            </div>

            <div class="field">
              <label for="research-competitors" class="field-label">Competitors (comma-separated)</label>
              <input
                id="research-competitors"
                class="input"
                type="text"
                [(ngModel)]="featureResearchForm.competitors"
                placeholder="Linear, Jira, ClickUp"
              />
            </div>

            <div class="field">
              <label for="research-window" class="field-label">Time Window (days)</label>
              <input
                id="research-window"
                class="input"
                type="number"
                min="7"
                max="730"
                [(ngModel)]="featureResearchForm.time_window_days"
              />
            </div>
          </div>

          <div class="agent-query-actions">
            <button
              type="button"
              class="primary-btn"
              (click)="startFeatureResearchRun()"
              [disabled]="featureResearchIsSubmitting || !featureResearchForm.feature.trim() || !featureResearchForm.category.trim()"
            >
              {{ featureResearchIsSubmitting ? 'Starting...' : 'Run research' }}
            </button>
            <button
              type="button"
              class="chip-btn ghost"
              (click)="featureResearchForm = { feature: '', category: '', persona: '', competitors: '', time_window_days: 180 }"
            >
              Clear
            </button>
          </div>
        </section>

        <section class="surface-card">
          <header class="card-head">
            <h2>Live Progress</h2>
            <span class="chip-btn ghost" *ngIf="featureResearchRunId">Run: {{ featureResearchRunId }}</span>
          </header>
          <div class="agent-progress-grid">
            <div class="agent-progress-item">
              <p class="detail-label">Status</p>
              <p>{{ featureResearchRun?.status || 'idle' }}</p>
            </div>
            <div class="agent-progress-item">
              <p class="detail-label">Step</p>
              <p>{{ featureResearchRun?.step || 'N/A' }}</p>
            </div>
            <div class="agent-progress-item">
              <p class="detail-label">Pages Visited</p>
              <p>{{ featureResearchRun?.progress?.pagesVisited || 0 }}</p>
            </div>
            <div class="agent-progress-item">
              <p class="detail-label">Evidence</p>
              <p>{{ featureResearchRun?.progress?.evidenceCount || 0 }}</p>
            </div>
            <div class="agent-progress-item">
              <p class="detail-label">Themes</p>
              <p>{{ featureResearchRun?.progress?.themesCount || 0 }}</p>
            </div>
          </div>
          <p class="agent-error-text" *ngIf="featureResearchRun?.error">{{ featureResearchRun?.error }}</p>
        </section>

        <section class="surface-card">
          <div class="agent-results-tabs">
            <button type="button" class="chip-btn" [class.ghost]="featureResearchTab !== 'themes'" (click)="setFeatureResearchTab('themes')">Themes</button>
            <button type="button" class="chip-btn" [class.ghost]="featureResearchTab !== 'evidence'" (click)="setFeatureResearchTab('evidence')">Evidence</button>
            <button type="button" class="chip-btn" [class.ghost]="featureResearchTab !== 'brief'" (click)="setFeatureResearchTab('brief')">Brief</button>
          </div>

          <div *ngIf="featureResearchTab === 'themes'" class="agent-tab-body">
            <div class="agent-empty-text" *ngIf="featureResearchThemes.length === 0">No themes yet.</div>
            <article class="agent-theme-card" *ngFor="let theme of featureResearchThemes">
              <h3>{{ theme.label }}</h3>
              <p>Count: {{ theme.count }}</p>
              <p>Confidence: {{ theme.confidence | number:'1.2-2' }}</p>
            </article>
          </div>

          <div *ngIf="featureResearchTab === 'evidence'" class="agent-tab-body">
            <div class="agent-empty-text" *ngIf="featureResearchEvidence.length === 0">No evidence collected yet.</div>
            <div class="agent-evidence-table-wrap" *ngIf="featureResearchEvidence.length > 0">
              <table class="agent-evidence-table">
                <thead>
                  <tr>
                    <th>Source</th>
                    <th>Snippet</th>
                    <th>URL</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of featureResearchEvidence">
                    <td>{{ item.source_type }}</td>
                    <td>{{ item.snippet }}</td>
                    <td><a [href]="item.url" target="_blank" rel="noopener noreferrer">{{ item.url }}</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div *ngIf="featureResearchTab === 'brief'" class="agent-tab-body">
            <div class="agent-empty-text" *ngIf="!featureResearchBrief">No brief generated yet.</div>
            <div *ngIf="featureResearchBrief">
              <p><strong>Feature:</strong> {{ featureResearchBrief.feature }}</p>
              <p><strong>Category:</strong> {{ featureResearchBrief.category }}</p>
              <p><strong>Priority:</strong> {{ featureResearchBrief.priority }}</p>
              <p><strong>Confidence:</strong> {{ featureResearchBrief.confidence }}</p>
              <p><strong>Summary:</strong> {{ featureResearchBrief.summary }}</p>
              <details>
                <summary>Raw JSON</summary>
                <pre>{{ pretty(featureResearchBrief) }}</pre>
              </details>
            </div>
          </div>
        </section>
      </section>

      <section class="kanban-view" *ngIf="currentView === 'kanban'">
        <header class="view-head">
          <h1>Kanban Board</h1>
          <p>Drag decisions between stages to track execution and review load.</p>
        </header>

        <div class="kanban-scroll" role="list">
          <section class="kanban-column" *ngFor="let column of kanbanColumns; trackBy: trackById" (dragover)="onDragOver($event)" (drop)="onDrop($event, column.id)">
            <header class="kanban-column-head">
              <h2>{{ column.title }}</h2>
              <span class="wip-counter" [class.over-limit]="column.items.length > column.wipLimit">
                {{ column.items.length }}/{{ column.wipLimit }} WIP
              </span>
            </header>

            <div class="kanban-card-list" *ngIf="column.items.length; else emptyKanbanColumn">
              <article
                class="kanban-card"
                *ngFor="let card of column.items; trackBy: trackById"
                draggable="true"
                (dragstart)="onDragStart($event, column.id, card.id)"
              >
                <h3>{{ card.title }}</h3>
                <div class="kanban-meta">
                  <span class="tag">{{ card.tag }}</span>
                  <span class="priority">{{ card.priority }}</span>
                </div>
                <div class="assignee">{{ card.assignee }}</div>
              </article>
            </div>

            <ng-template #emptyKanbanColumn>
              <p class="kanban-empty">Drop cards here</p>
            </ng-template>
          </section>
        </div>
      </section>

      <section class="settings-view" *ngIf="currentView === 'settings'">
        <header class="view-head narrow">
          <h1>Settings</h1>
          <p>Manage organization behavior, Slack setup, and integration controls.</p>
        </header>

        <div class="settings-stack">
          <section class="surface-card">
            <header class="card-head"><h2>Organization Settings</h2></header>
            <article class="setting-row" *ngFor="let setting of organizationSettings; let i = index">
              <div>
                <h3>{{ setting.title }}</h3>
                <p>{{ setting.description }}</p>
              </div>
              <button
                type="button"
                class="toggle"
                role="switch"
                [attr.aria-checked]="setting.enabled"
                [class.on]="setting.enabled"
                (click)="toggleOrgSetting(i)"
              >
                <span></span>
              </button>
            </article>
          </section>

          <section class="surface-card">
            <header class="card-head"><h2>Slack Setup</h2></header>
            <div class="slack-status">
              <p>Connection status: <strong>{{ integrations[0].status }}</strong></p>
              <a class="inline-link" routerLink="/app/integration">Open integration center</a>
              <span style="margin: 0 6px;">|</span>
              <a class="inline-link" routerLink="/app/decision-operator">Open decision operator</a>
            </div>
          </section>

          <section class="surface-card">
            <header class="card-head"><h2>Integrations</h2></header>
            <div class="integration-table" role="table" aria-label="Integration settings table">
              <div class="integration-row header" role="row">
                <span>Provider</span><span>Status</span><span>Events</span><span>Enabled</span>
              </div>
              <div class="integration-row" role="row" *ngFor="let integration of integrations; let i = index">
                <span>{{ integration.name }}</span>
                <span [class.integration-offline]="integration.status === 'Disconnected'">{{ integration.status }}</span>
                <span>{{ integration.events }}</span>
                <button
                  type="button"
                  class="toggle"
                  role="switch"
                  [attr.aria-checked]="integration.enabled"
                  [class.on]="integration.enabled"
                  (click)="toggleIntegration(i)"
                  [attr.aria-label]="'Toggle ' + integration.name"
                >
                  <span></span>
                </button>
              </div>
            </div>
          </section>
        </div>
      </section>

      <section class="fallback-view" *ngIf="currentView === 'sprints' || currentView === 'automations' || currentView === 'integrations' || currentView === 'reports'">
        <article class="surface-card">
          <h1>{{ currentView | titlecase }}</h1>
          <p>This area is aligned with the new design system and ready for feature-specific content.</p>
          <button type="button" class="primary-btn" (click)="setView('chat')">Back to Chat</button>
        </article>
      </section>
    </main>
  </div>

  <section class="toast-stack" aria-live="polite" aria-label="Notifications">
    <article
      class="toast"
      *ngFor="let notification of notifications"
      [class.toast-success]="notification.type === 'success'"
      [class.toast-error]="notification.type === 'error'"
      [class.toast-info]="notification.type === 'info'"
      (click)="dismissNotification(notification.id)"
    >
      {{ notification.message }}
    </article>
  </section>

  <div class="modal-overlay" *ngIf="showNewDecisionModal" (click)="closeNewDecisionModal()">
    <section
      #newDecisionModal
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="new-decision-title"
      (click)="$event.stopPropagation()"
      (keydown)="onNewDecisionModalKeydown($event)"
    >
      <header class="modal-head">
        <h2 id="new-decision-title">New Decision</h2>
        <button type="button" class="icon-btn" aria-label="Close modal" (click)="closeNewDecisionModal()">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" /></svg>
        </button>
      </header>

      <div class="modal-body">
        <div class="field">
          <label for="decision-title">Title *</label>
          <input #newDecisionTitleInput id="decision-title" class="input" type="text" [(ngModel)]="newDecision.title" />
        </div>

        <div class="field">
          <label for="decision-problem">Problem Statement *</label>
          <textarea id="decision-problem" class="input textarea" rows="2" [(ngModel)]="newDecision.problem"></textarea>
        </div>

        <div class="field">
          <label for="decision-evidence">Evidence *</label>
          <textarea id="decision-evidence" class="input textarea" rows="2" [(ngModel)]="newDecision.evidence"></textarea>
        </div>

        <div class="field">
          <label>Options *</label>
          <div class="option-input-row" *ngFor="let option of newDecision.options; let i = index">
            <input class="input" type="text" [(ngModel)]="newDecision.options[i]" [placeholder]="'Option ' + (i + 1)" />
            <button type="button" class="icon-btn" (click)="removeNewOption(i)" aria-label="Remove option">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" /></svg>
            </button>
          </div>
          <button type="button" class="chip-btn ghost" (click)="addNewOption()">+ Add Option</button>
        </div>

        <div class="two-col">
          <div class="field">
            <label for="decision-owner">Owner *</label>
            <input id="decision-owner" class="input" type="text" [(ngModel)]="newDecision.owner" />
          </div>
          <div class="field">
            <label for="decision-impact">Impact *</label>
            <input id="decision-impact" class="input" type="text" [(ngModel)]="newDecision.impact" placeholder="e.g. +$2M ARR" />
          </div>
        </div>

        <div class="field">
          <label for="decision-risk">Tradeoff / Risk</label>
          <input id="decision-risk" class="input" type="text" [(ngModel)]="newDecision.tradeoff" />
        </div>

        <div class="field">
          <label for="decision-confidence">Confidence: {{ newDecision.confidence }}%</label>
          <input id="decision-confidence" type="range" min="0" max="100" [(ngModel)]="newDecision.confidence" class="slider" />
        </div>
      </div>

      <footer class="modal-footer">
        <p class="error-text" *ngIf="!modalIsValid">Required fields are marked with *.</p>
        <div class="modal-actions">
          <button type="button" class="chip-btn ghost" (click)="closeNewDecisionModal()">Cancel</button>
          <button type="button" class="primary-btn" [disabled]="!modalIsValid" (click)="saveNewDecision()">Create</button>
        </div>
      </footer>
    </section>
  </div>

  <div class="modal-overlay" *ngIf="showShortcutsModal" (click)="showShortcutsModal = false">
    <section class="modal shortcuts-modal" role="dialog" aria-modal="true" aria-labelledby="shortcuts-title" (click)="$event.stopPropagation()">
      <header class="modal-head">
        <h2 id="shortcuts-title">Keyboard Shortcuts</h2>
        <button type="button" class="icon-btn" aria-label="Close shortcuts" (click)="showShortcutsModal = false">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" /></svg>
        </button>
      </header>
      <div class="modal-body">
        <div class="shortcut-row"><span>Ctrl + K</span><span>Focus search</span></div>
        <div class="shortcut-row"><span>Ctrl + 1</span><span>Go to Chat</span></div>
        <div class="shortcut-row"><span>Ctrl + 2</span><span>Go to Inbox</span></div>
        <div class="shortcut-row"><span>Ctrl + 3</span><span>Go to Agent Feature</span></div>
        <div class="shortcut-row"><span>Ctrl + Enter</span><span>Send chat message</span></div>
        <div class="shortcut-row"><span>Esc</span><span>Close modal/sidebar</span></div>
        <div class="shortcut-row"><span>?</span><span>Open shortcuts</span></div>
      </div>
    </section>
  </div>
</div>

